{\rtf1\ansi\ansicpg1252\deff0\nouicompat\deflang1033{\fonttbl{\f0\fnil Courier New;}{\f1\fnil\fcharset0 Calibri;}}
{\colortbl ;\red0\green0\blue128;\red0\green0\blue0;\red128\green128\blue128;\red102\green14\blue122;\red0\green0\blue255;\red128\green128\blue0;\red0\green128\blue0;\red0\green115\blue191;\red255\green255\blue255;}
{\*\generator Riched20 10.0.10586}\viewkind4\uc1 
\pard\box\brdrdash\brdrw0 \cbpat9\sa200\sl276\slmult1\cf1\b\f0\fs18\lang9 package \cf2\b0 com.example.sakumar.thirdi;\line\line\cf1\b import \cf2\b0 android.content.Context;\line\cf1\b import \cf2\b0 android.content.DialogInterface;\line\cf1\b import \cf2\b0 android.content.Intent;\line\cf1\b import \cf2\b0 android.location.Location;\line\cf1\b import \cf2\b0 android.location.LocationManager;\line\cf1\b import \cf2\b0 android.net.Uri;\line\cf1\b import \cf2\b0 android.support.v4.app.ActivityCompat;\line\cf1\b import \cf2\b0 android.support.v7.app.AlertDialog;\line\cf1\b import \cf2\b0 android.support.v7.app.AppCompatActivity;\line\cf1\b import \cf2\b0 android.os.Bundle;\line\cf1\b import \cf2\b0 android.view.View;\line\cf1\b import \cf2\b0 android.widget.Button;\line\cf1\b import \cf2\b0 android.location.LocationListener;\line\line\line\cf1\b import \cf2\b0 android.content.Intent;\line\cf1\b import \cf2\b0 android.content.pm.PackageManager;\line\cf1\b import \cf2\b0 android.location.Address;\line\cf1\b import \cf2\b0 android.location.Geocoder;\line\cf1\b import \cf2\b0 android.location.Location;\line\cf1\b import \cf2\b0 android.os.Bundle;\line\cf3\i //import android.support.v4.app.ActivityCompat;\line //import android.support.v4.app.FragmentActivity;\line\cf1\b\i0 import \cf2\b0 android.util.Log;\line\cf1\b import \cf2\b0 android.widget.TextView;\line\cf1\b import \cf2\b0 android.widget.Toast;\line\line\cf1\b import \cf2\b0 com.google.android.gms.common.ConnectionResult;\line\cf1\b import \cf2\b0 com.google.android.gms.common.GooglePlayServicesUtil;\line\cf3\i //import com.google.android.gms.common.api.GoogleApiClient;\line\cf1\b\i0 import \cf2\b0 com.google.android.gms.common.api.GoogleApiClient.ConnectionCallbacks;\line\cf1\b import \cf2\b0 com.google.android.gms.common.api.GoogleApiClient.OnConnectionFailedListener;\line\cf3\i //import com.google.android.gms.location.LocationListener;\line\cf1\b\i0 import \cf2\b0 com.google.android.gms.location.LocationRequest;\line\cf1\b import \cf2\b0 com.google.android.gms.location.LocationServices;\line\cf1\b import \cf2\b0 com.google.android.gms.location.LocationServices;\line\cf1\b import \cf2\b0 com.google.android.gms.maps.CameraUpdateFactory;\line\cf1\b import \cf2\b0 com.google.android.gms.maps.GoogleMap;\line\cf3\i //import com.google.android.gms.maps.OnMapReadyCallback;\line\cf1\b\i0 import \cf2\b0 com.google.android.gms.maps.SupportMapFragment;\line\cf1\b import \cf2\b0 com.google.android.gms.maps.model.CameraPosition;\line\cf1\b import \cf2\b0 com.google.android.gms.maps.model.LatLng;\line\cf1\b import \cf2\b0 com.google.android.gms.maps.model.MarkerOptions;\line\line\cf1\b import \cf2\b0 java.io.IOException;\line\cf1\b import \cf2\b0 java.util.List;\line\cf1\b import \cf2\b0 java.util.Locale;\line\line\line\cf1\b import \cf2\b0 com.google.android.gms.common.api.GoogleApiClient;\line\cf1\b import \cf2\b0 com.google.android.gms.location.LocationServices;\line\cf1\b import \cf2\b0 com.google.android.gms.common.ConnectionResult;\line\cf1\b import \cf2\b0 com.google.android.gms.common.api.GoogleApiClient;\line\cf1\b import \cf2\b0 com.google.android.gms.common.api.GoogleApiClient.ConnectionCallbacks;\line\cf1\b import \cf2\b0 com.google.android.gms.common.api.GoogleApiClient.OnConnectionFailedListener;\line\cf3\i //import com.google.android.gms.location.LocationListener;\line\cf1\b\i0 import \cf2\b0 com.google.android.gms.location.LocationRequest;\line\cf1\b import \cf2\b0 com.google.android.gms.location.LocationServices;\line\line\line\cf1\b public class \cf2\b0 MainActivity \cf1\b extends \cf2\b0 AppCompatActivity \cf1\b implements \cf2\b0 ConnectionCallbacks, OnConnectionFailedListener \{\line     \cf1\b private \cf2\b0 Location \cf4\b mLastLocation\cf2\b0 ;\line     \cf1\b private \cf2\b0 GoogleApiClient \cf4\b mGoogleApiClient\cf2\b0 ;\line     \cf1\b double \cf4 longitude\cf2\b0 , \cf4\b latitude\cf2\b0 ;\line     \cf1\b private static final \cf2\b0 String \cf4\b\i TAG \cf2\b0\i0 = MainActivity.\cf1\b class\cf2\b0 .getSimpleName();\line     \cf1\b private final static int \cf4\i PLAY_SERVICES_RESOLUTION_REQUEST \cf2\b0\i0 = \cf5 1000\cf2 ;\line\line     Button \cf4\b call\cf2\b0 , \cf4\b SOS\cf2\b0 , \cf4\b rate\cf2\b0 ;\line\line\line     \cf6 @Override\line     \cf1\b protected void \cf2\b0 onCreate(Bundle savedInstanceState) \{\line         \cf1\b super\cf2\b0 .onCreate(savedInstanceState);\line         setContentView(R.layout.\cf4\b\i activity_main\cf2\b0\i0 );\line         \cf4\b call \cf2\b0 = (Button) findViewById(R.id.\cf4\b\i button\cf2\b0\i0 );\line         \cf4\b SOS \cf2\b0 = (Button) findViewById(R.id.\cf4\b\i button2\cf2\b0\i0 );\line         \cf4\b rate \cf2\b0 = (Button) findViewById(R.id.\cf4\b\i button4\cf2\b0\i0 );\line         \cf1\b if \cf2\b0 (checkPlayServices()) \{\line             \cf3\i // Building the GoogleApi client\line             \cf2\i0 buildGoogleApiClient();\line         \}\line\line\line         \cf4\b call\cf2\b0 .setOnClickListener(\cf1\b new \cf2\b0 View.OnClickListener() \{\line             \cf6 @Override\line             \cf1\b public void \cf2\b0 onClick(View v) \{\line                 Intent callI = \cf1\b new \cf2\b0 Intent(Intent.\cf4\b\i ACTION_CALL\cf2\b0\i0 );\line                 callI.setData(Uri.\i parse\i0 (\cf7\b "tel:" \cf2\b0 + \cf5 100\cf2 ));\line                 \cf1\b try \cf2\b0\{\line                     startActivity(callI);\line                 \} \cf1\b catch \cf2\b0 (Exception e) \{\line                     e.printStackTrace();\line                 \}\line             \}\line         \});\line\line         \cf4\b rate\cf2\b0 .setOnClickListener(\cf1\b new \cf2\b0 View.OnClickListener() \{\line             \cf6 @Override\line             \cf1\b public void \cf2\b0 onClick(View vi) \{\line                 Intent nxtactivity = \cf1\b new \cf2\b0 Intent(\cf7\b "com.example.sakumar.thirdi.RatingActivity"\cf2\b0 );\line                 startActivity(nxtactivity);\line             \}\line         \});\line     \}\line\line     \cf1\b public void \cf2\b0 displayLocation() \{\line\line\line         \cf1\b if \cf2\b0 (ActivityCompat.\i checkSelfPermission\i0 (\cf1\b this\cf2\b0 , android.Manifest.permission.\cf4\b\i ACCESS_FINE_LOCATION\cf2\b0\i0 ) != PackageManager.\cf4\b\i PERMISSION_GRANTED \cf2\b0\i0 && ActivityCompat.\i checkSelfPermission\i0 (\cf1\b this\cf2\b0 , android.Manifest.permission.\cf4\b\i ACCESS_COARSE_LOCATION\cf2\b0\i0 ) != PackageManager.\cf4\b\i PERMISSION_GRANTED\cf2\b0\i0 ) \{\line             \cf3\i // \cf8\b TODO: Consider calling\line             \cf3\b0 //    ActivityCompat#requestPermissions\line             // here to request the missing permissions, and then overriding\line             //   public void onRequestPermissionsResult(int requestCode, String[] permissions,\line             //                                          int[] grantResults)\line             // to handle the case where the user grants the permission. See the documentation\line             // for ActivityCompat#requestPermissions for more details.\line             \cf1\b\i0 return\cf2\b0 ;\line         \}\line\line        \cf3\i /* Toast t2 = Toast.makeText(getApplicationContext(), "displaylocationCalled", Toast.LENGTH_SHORT);\line         t2.setGravity(Gravity.TOP | Gravity.CENTER_HORIZONTAL, 0, 0);\line         t2.show();*/\line         //mLastLocation = LocationServices.FusedLocationApi.getLastLocation(mGoogleApiClient);\line         \cf4\b\i0 mLastLocation \cf2\b0 = LocationServices.\cf4\b\i FusedLocationApi\cf2\b0\i0 .getLastLocation(\cf4\b mGoogleApiClient\cf2\b0 );\line\line         \cf1\b if \cf2\b0 (\cf4\b mLastLocation \cf2\b0 != \cf1\b null\cf2\b0 ) \{\line             \cf4\b latitude \cf2\b0 = \cf4\b mLastLocation\cf2\b0 .getLatitude();\line             \cf4\b longitude \cf2\b0 = \cf4\b mLastLocation\cf2\b0 .getLongitude();\line         \} \cf1\b else \cf2\b0\{\line             showGPSDisabledAlertToUser();\line         \}\line     \}\line\line     \cf1\b protected synchronized void \cf2\b0 buildGoogleApiClient() \{\line         \cf3\i // if(mGoogleApiClient == null) \{\line         \cf4\b\i0 mGoogleApiClient \cf2\b0 = \cf1\b new \cf2\b0 GoogleApiClient.Builder(\cf1\b this\cf2\b0 )\line                 .addConnectionCallbacks(\cf1\b this\cf2\b0 )\line                 .addOnConnectionFailedListener(\cf1\b this\cf2\b0 )\line                 .addApi(LocationServices.\cf4\b\i API\cf2\b0\i0 )\line                 .build();\line     \}\line        \cf3\i /* Toast t8 = Toast.makeText(getApplicationContext(), "buildGoogleApiClient Called", Toast.LENGTH_SHORT);\line         t8.show();*/\line\line\line     /***************************************************/\line\line     \cf1\b\i0 private boolean \cf2\b0 checkPlayServices() \{\line         \cf3\i // Toast t7 = Toast.makeText(getApplicationContext(), "CheckPlayServicesCalled", Toast.LENGTH_SHORT);\line         //t7.show();\line\line         \cf1\b\i0 int \cf2\b0 resultCode = GooglePlayServicesUtil.\i isGooglePlayServicesAvailable\i0 (\cf1\b this\cf2\b0 );\line         \cf1\b if \cf2\b0 (resultCode != ConnectionResult.\cf4\b\i SUCCESS\cf2\b0\i0 ) \{\line             \cf1\b if \cf2\b0 (GooglePlayServicesUtil.\i isUserRecoverableError\i0 (resultCode)) \{\line                 GooglePlayServicesUtil.\i getErrorDialog\i0 (resultCode, \cf1\b this\cf2\b0 ,\line                         \cf4\b\i PLAY_SERVICES_RESOLUTION_REQUEST\cf2\b0\i0 ).show();\line             \} \cf1\b else \cf2\b0\{\line                 Toast.\i makeText\i0 (getApplicationContext(),\line                         \cf7\b "This device is not supported."\cf2\b0 , Toast.\cf4\b\i LENGTH_LONG\cf2\b0\i0 )\line                         .show();\line                 finish();\line             \}\line             \cf1\b return false\cf2\b0 ;\line         \}\line\line         \cf1\b return true\cf2\b0 ;\line     \}\line\line     \cf1\b protected void \cf2\b0 onStart() \{\line         \cf1\b super\cf2\b0 .onStart();\line         \cf1\b if \cf2\b0 (\cf4\b mGoogleApiClient \cf2\b0 != \cf1\b null\cf2\b0 ) \{\line             \cf4\b mGoogleApiClient\cf2\b0 .connect();\line         \}\line         \cf3\i //  Toast t6 = Toast.makeText(getApplicationContext(), "onStartCalled", Toast.LENGTH_SHORT);\line         //t6.show();\line     \cf2\i0\}\line\line     \cf6 @Override\line     \cf1\b protected void \cf2\b0 onResume() \{\line         \cf3\i // Toast t5 = Toast.makeText(getApplicationContext(), "ResumedCalled", Toast.LENGTH_SHORT);\line         //t5.show();\line         \cf1\b\i0 super\cf2\b0 .onResume();\line\line         checkPlayServices();\line\line\line     \}\line\line     \cf3\i /**\line      * Google api callback methods\line      */\line     \cf6\i0 @Override\line     \cf1\b public void \cf2\b0 onConnectionFailed(ConnectionResult result) \{\line         Log.\i i\i0 (\cf4\b\i TAG\cf2\b0\i0 , \cf7\b "Connection failed: ConnectionResult.getErrorCode() = "\line                 \cf2\b0 + result.getErrorCode());\line     \}\line\line     \cf1\b public void \cf2\b0 onConnected(Bundle arg0) \{\line         \cf3\i // Toast t1 = Toast.makeText(getApplicationContext(), "OnConnectedCalled", Toast.LENGTH_SHORT);\line         //t1.setGravity(Gravity.TOP | Gravity.CENTER_HORIZONTAL, 6, 0);\line         //t1.show();\line         // Once connected with google api, get the location\line\line         \cf2\i0 displayLocation();\line     \}\line\line     \cf1\b public void \cf2\b0 onConnectionSuspended(\cf1\b int \cf2\b0 arg0) \{\line         \cf4\b mGoogleApiClient\cf2\b0 .connect();\line         \cf3\i // Toast t3 = Toast.makeText(getApplicationContext(), "connection suspended", Toast.LENGTH_SHORT);\line         //t3.show();\line     \cf2\i0\}\line\line     \cf1\b private void \cf2\b0 showGPSDisabledAlertToUser() \{\line         AlertDialog.Builder alertDialogBuilder = \cf1\b new \cf2\b0 AlertDialog.Builder(MainActivity.\cf1\b this\cf2\b0 );\line         alertDialogBuilder\line                 .setMessage(\cf7\b "GPS is disabled in your device. Would you like to enable it?"\cf2\b0 )\line                 .setCancelable(\cf1\b false\cf2\b0 )\line                 .setPositiveButton(\cf7\b "Enable GPS"\cf2\b0 , \cf1\b new \cf2\b0 DialogInterface.OnClickListener() \{\line                     \cf1\b public void \cf2\b0 onClick(DialogInterface dialog, \cf1\b int \cf2\b0 id) \{\line                         Intent callGPSSettingIntent = \cf1\b new \cf2\b0 Intent(android.provider.Settings.\cf4\b\i ACTION_LOCATION_SOURCE_SETTINGS\cf2\b0\i0 );\line                         startActivity(callGPSSettingIntent);\line\line                         \cf3\i //checkPlayServices();\line                     \cf2\i0\}\line\line                 \});\line\line         alertDialogBuilder.setNegativeButton(\cf7\b "Cancel"\cf2\b0 ,\line                 \cf1\b new \cf2\b0 DialogInterface.OnClickListener() \{\line                     \cf1\b public void \cf2\b0 onClick(DialogInterface dialog, \cf1\b int \cf2\b0 id) \{\line\line                         dialog.cancel();\line                     \}\line                 \});\line         AlertDialog alert = alertDialogBuilder.create();\line         alert.show();\line\line     \}\cf3\i // ;\line\line\line     \cf1\b\i0 public void \cf2\b0 send(View view) \{\line         \cf1\b if \cf2\b0 (ActivityCompat.\i checkSelfPermission\i0 (\cf1\b this\cf2\b0 , android.Manifest.permission.\cf4\b\i ACCESS_FINE_LOCATION\cf2\b0\i0 ) != PackageManager.\cf4\b\i PERMISSION_GRANTED \cf2\b0\i0 && ActivityCompat.\i checkSelfPermission\i0 (\cf1\b this\cf2\b0 , android.Manifest.permission.\cf4\b\i ACCESS_COARSE_LOCATION\cf2\b0\i0 ) != PackageManager.\cf4\b\i PERMISSION_GRANTED\cf2\b0\i0 ) \{\line             \cf3\i // \cf8\b TODO: Consider calling\line             \cf3\b0 //    ActivityCompat#requestPermissions\line             // here to request the missing permissions, and then overriding\line             //   public void onRequestPermissionsResult(int requestCode, String[] permissions,\line             //                                          int[] grantResults)\line             // to handle the case where the user grants the permission. See the documentation\line             // for ActivityCompat#requestPermissions for more details.\line             \cf1\b\i0 return\cf2\b0 ;\line         \}\line         \cf4\b mLastLocation \cf2\b0 = LocationServices.\cf4\b\i FusedLocationApi\cf2\b0\i0 .getLastLocation(\cf4\b mGoogleApiClient\cf2\b0 );\line         \cf1\b if\cf2\b0 (\cf4\b mLastLocation \cf2\b0 != \cf1\b null\cf2\b0 ) \{\line             \cf4\b latitude \cf2\b0 = \cf4\b mLastLocation\cf2\b0 .getLatitude();\line             \cf4\b longitude \cf2\b0 = \cf4\b mLastLocation\cf2\b0 .getLongitude();\line         \}\line\line\line         Intent smsIntent = \cf1\b new \cf2\b0 Intent(Intent.\cf4\b\i ACTION_VIEW\cf2\b0\i0 );\line         \cf3\i //String uri = "{{\field{\*\fldinst{HYPERLINK http://maps.google.com/maps?saddr= }}{\fldrslt{http://maps.google.com/maps?saddr=\ul0\cf0}}}}\f0\fs18 " + mLastLocation.getLatitude()+","+currentLocation.getLongitude();\line\line         \cf2\i0 smsIntent.setType(\cf7\b "vnd.android-dir/mms-sms"\cf2\b0 );\line         smsIntent.putExtra(\cf7\b "address" \cf2\b0 ,\cf7\b "9799235966;7382781729;7587298523"\cf2\b0 );\line         smsIntent.putExtra(\cf7\b "sms_body"\cf2\b0 , \cf7\b "I am in danger,  {{\field{\*\fldinst{HYPERLINK http://maps.google.com/maps?saddr= }}{\fldrslt{http://maps.google.com/maps?saddr=\ul0\cf0}}}}\f0\fs18 " \cf2\b0 + \cf4\b latitude \cf2\b0 +\cf7\b ","\cf2\b0 + \cf4\b longitude\cf2\b0 );\line\line        \cf3\i // smsIntent.putExtra("wysokosc",displayLocation().latitude);\line         //i.putExtra("speed", PSpeed);\line\line         \cf2\i0 startActivity(smsIntent);\line\line\line     \}\line\line\}\line\par

\pard\sa200\sl276\slmult1\cf0\f1\fs22\par
}
 